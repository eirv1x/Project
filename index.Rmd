---
output: html_document
runtime: shiny
---

---
title: "PSY6422 Project"
author: "E Irving"
date: "13/04/2022"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(tidyverse)
library(shiny)
library(ggrepel)
```

# Data Origins 

### Where is the data from?
The Office for National Statistics (ONS)

Citation: Office for National Statistics. (2022,April). Personal Well-being estimates by local authority. https://www.ons.gov.uk/datasets/wellbeing-local-authority/editions/time-series/versions/2


### How was it collected?
This data was collected through the Annual Population Survey (APS)

### What do the variables mean?
The variables in the dataset include: 'Anxiety', 'Life Satisfaction', 'Worthwhile', and 'Happiness'. These variables are the four factors used to measure personal well-being. 
For 'Anxiety', higher scores indicate lower personal well-being. 
For 'Life satisfaction', 'Worthwhile', and 'Happiness', high scores equal high personal well-being. 

#### Show first few rows of raw data if possible

```{r data import}
pwbestlocalauth <- read.csv(here("data", "pwbest_localauth_filtered.csv"))
#head(pwbestlocalauth)
```

```{r showing first few rows of raw data}
head(pwbestlocalauth, 4)
```

# Research Questions
What question(s) does my visualisation attempt to address?
My visualization attempts to demonstrate the differences in personal well-being between different countries for every year since 2016-2017, to the current year. 

# Data Preparation

```{r datawrangling}
##data wrangling is needed to rename and remove columns that are not necessary for visualisation
#rename: change column/variable names to something short
pwbestlocalauth <- pwbestlocalauth %>% 
  rename(Geography = Title, pwb = X, '2016-17' = X.2, '2017-18' = X.6, '2018-19' = X.10, '2019-20' = X.14, '2020-21' = X.18)

# use select to just look at some columns
pwbestlocalauth <- pwbestlocalauth %>% 
  select(Geography, pwb, '2016-17', '2017-18','2018-19', '2019-20', '2020-21')
#head(pwbestlocalauth)

#remove rows from dataset
pwbestlocalauth <- pwbestlocalauth[-c(1,2),]
head(pwbestlocalauth, 3)
```

## Summary statistics - grouped variables etc. 

```{r group statistics}


```


# Visualisations
-inlude a document explaining any motivation (although good graph labelling is better than an explanation in the accompanying text.)
The code for producing these graphs. 

## Visualisation 1

A scatter plot to show the personal well-being data for the year 2016-17:

```{r scatterplot}

cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7") #use of colourblind palette 

p <- ggplot(pwbestlocalauth,aes(x=pwb,y=`2016-17`,color = Geography))
p + geom_point(size=2.5) + geom_smooth(alpha=0.3, method = 'lm') + labs(x = "Personal Wellbeing Measures",
                                                                 y = "Scores", title = "Personal Wellbeing Scores in 2016-2017") + scale_colour_manual(values=cbPalette) + geom_text_repel(aes(label=Geography))

ggsave(here("figs", "16-17plot.png"))
```

## Visualisation 2

Shiny interactive graph:

```{r Shiny}

ui <- shinyUI(fluidPage(
  titlePanel("Personal Wellbeing Scores across the UK"),
  sidebarLayout(
    sidebarPanel(
      radioButtons(inputId = "year", #created a button panel for the user to select the year they wish to view
                   label = "Please select a year:",
                   choices=c("2016-17" = "2016-17", "2017-18" = "2017-18","2018-19" = "2018-19", "2019-20" = "2019-20","2020-21" = "2020-21"),
                   
                   selected = "2016-17" #automatically set on the year 2016-2017
      ),
      radioButtons(inputId="filetype", label="Select the file type to download", choices = list("png","pdf")),
      downloadButton(outputId = "down", label = "Download plot")),
    
    mainPanel(
      plotOutput("scatterplot"),
      textOutput("text")
    )
)
))


#now to instruct the server what to display 
server <- shinyServer(function(input,output){
  output$scatterplot <- renderPlot({#ggplot used to create a scatterplot of the data depending on year picked by user
   ggplot(pwbestlocalauth, aes(x= pwb, y=get(input$year), color = Geography)) + geom_point(shape=1, size=3) + geom_smooth(alpha=0.3, method = 'lm') + labs(x = "Personal Wellbeing Measures", y = "Scores", title = "Personal Wellbeing Scores") + geom_text_repel(aes(label=Geography), force=25) + scale_colour_manual(values=cbPalette) + theme_light() + theme(text=element_text(color="black", size=11), legend.position = c("top"), legend.direction = "horizontal", axis.title.x=element_text(vjust=-1.5),
                              legend.justification = 0.5, legend.text=element_text(size=11,color="black"), axis.line=element_line(color="black", size=0.2), axis.line.y=element_blank(),panel.grid.major=element_line(color="gray50", size=0.5), panel.grid.major.x = element_blank())
  })
  
  output$text <- renderText({"Personal WellBeing (PWB) Scores Key:
    Low anxiety = High PWB, Low happiness, satisfaction, worthwhile = Low PWB"})
  
  output$down <- downloadHandler(
    filename = function(){
     paste("pwb",input$year,input$filetype,sep='.') 
    },
    content = function(file){
      if(input$filetype == "png")
        png(file)
      else
        pdf(file)
      plot(ggplot(pwbestlocalauth, aes(x= pwb, y=get(input$year), color = Geography)) + geom_point(shape=1, size=3) + geom_smooth(alpha=0.3, method = 'lm') + labs(x = "Personal Wellbeing Measures", y = "Scores", title = "Personal Wellbeing Scores") + geom_text_repel(aes(label=Geography), force=25) + scale_colour_manual(values=cbPalette) + theme_light() + theme(text=element_text(color="black", size=11), legend.position = c("top"), legend.direction = "horizontal", axis.title.x=element_text(vjust=-1.5),
                              legend.justification = 0.5, legend.text=element_text(size=11,color="black"), axis.line=element_line(color="black", size=0.2), axis.line.y=element_blank(),panel.grid.major=element_line(color="gray50", size=0.5), panel.grid.major.x = element_blank()))
  dev.off()
    }
  )
  
  

})

shinyApp(ui, server)
```


# Summary

What do I think the graph means?

What have I learnt whilst doing this project?

brief thoughts on what you have learnt, what you might do next if you had more time/more data
This practice project has enabled me to produce simple ggplots with my data, as well as creating a shiny interface where different graphs can be shown based on the year a user is interested in.



