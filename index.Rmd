---
output: 
  html_document: 
    toc: yes
    toc_float: true
    smooth_scroll: false
    theme: lumen
    highlight: haddock
runtime: shiny
---

---
title: "PSY6422 Project"
author: "210155305"
date: "13/04/2022"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) ##packages needed
library(here)
library(tidyverse)
library(shiny)
```

# Data Origin

I retrieved data from the Office for National Statistics (ONS), where I downloaded personal well-being scores from countries within the UK. This data had been collected through the Annual Population Survey (APS), consisting of a sample size of \~150,000.

Citation: Office for National Statistics. (2022,April). Personal Well-being estimates by local authority. <https://www.ons.gov.uk/datasets/wellbeing-local-authority/editions/time-series/versions/2>

```{r data import}
pwbestlocalauth <- read.csv(here("data", "pwbest_localauth_filtered.csv"))
head(pwbestlocalauth) 
```

Within this dataset, personal-well being was measured based on four variables: 'Anxiety', 'Life Satisfaction', 'Worthwhile', and 'Happiness'. These variables represented average mean scores. For this data visualisation, I focused only on personal well-being scores from UK countries.

#### The first few rows of raw data:

```{r showing first few rows of raw data}
head(pwbestlocalauth, 4)
```

# Research Questions

1)  How has personal well-being across UK countries, and the UK overall, fluctuated over recent years?

2)  On average, Which UK countries appear to have a higher level of personal well-being each year?

# Data Preparation

Several steps were taken to process my data.

1.  Renaming data columns
2.  Removing unnecessarry columns e.g., threshold data
3.  Removing unnecessary rows from the dataset

```{r datawrangling}

#rename data
pwbestlocalauth <- pwbestlocalauth %>% 
  rename(Geography = Title, pwb = X, '2016-17' = X.2, '2017-18' = X.6, '2018-19' = X.10, '2019-20' = X.14, '2020-21' = X.18)

# use select to only look at some columns
pwbestlocalauth <- pwbestlocalauth %>% 
  select(Geography, pwb, '2016-17', '2017-18','2018-19', '2019-20', '2020-21')
#head(pwbestlocalauth)

#remove rows from dataset
pwbestlocalauth <- pwbestlocalauth[-c(1,2),]
```

## Summary statistics - grouped variables etc.

Table displaying average personal well-being scores from first 4 rows:

```{r group statistics}
head(pwbestlocalauth, 4)
```

# Visualisations

The shiny app created displays a scatterplot of the personal well-being scores of each country. The interactive feature of this graph enables a user to choose which year they would like to look at personal well-being scores for. The app also allows a user to download the plots.

## Visualisation 1

A quick visualisation to test where the data points should lie on the scatterplot.

```{r scatterplot}

cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7") #use of colourblind palette 

#quick visualization test of datapoints
#p <- ggplot(pwbestlocalauth,aes(x=pwb,y=`2016-17`,color = Geography))
#p + geom_point(size=2.5) + geom_smooth(alpha=0.3, method = 'lm') + labs(x = "Personal Wellbeing Measures",y = "Scores", title = "Personal Wellbeing Scores in 2016-2017") + #scale_colour_manual(values=cbPalette)
#ggsave(here("figs", "16-17plot.png"))
```

## Visualisation 2

Shiny interactive graph:

```{r Shiny}

ui <- shinyUI(fluidPage(
  titlePanel("Personal Wellbeing Scores across the UK"),
  sidebarLayout(
    sidebarPanel(
      radioButtons(inputId = "year", #created a button panel for the user to select the year they wish to view
                   label = "Please select a year:",
                   choices=c("2016-17" = "2016-17", "2017-18" = "2017-18","2018-19" = "2018-19", "2019-20" = "2019-20","2020-21" = "2020-21"),
                   
                   selected = "2016-17" #automatically set on the year 2016-2017
      ),
      radioButtons(inputId="filetype", label="Select the file type to download", choices = list("png","pdf")),#buttonpanel to choose file type to download plot
      downloadButton(outputId = "down", label = "Download plot")),
    
    mainPanel(
      plotOutput("scatterplot"),
      textOutput("text"),
      textOutput("text2"),
      textOutput("text3")
    )
)
))


#instructions for server of what to display
server <- shinyServer(function(input,output){
  output$scatterplot <- renderPlot({#ggplot used to create a scatterplot of the data depending on year picked by user
   ggplot(pwbestlocalauth, aes(x= pwb, y=get(input$year), color = Geography)) + geom_point(size=3, position=position_jitter(h=.15,w=.12)) +  #jitter was used as points overlapped
      geom_smooth(alpha=0.3, method = 'lm') + 
      #customisation of plot for better visualisation
      labs(x = "Personal Wellbeing Measures", y = "Scores", title = "Personal Wellbeing Scores") + scale_colour_manual(values=cbPalette) + theme_light() + theme(text=element_text(color="black", size=11), legend.position = c("top"), legend.direction = "horizontal", axis.title.x=element_text(vjust=-1.5),
                              legend.justification = 0.5, legend.text=element_text(size=11,color="black"), axis.line=element_line(color="black", size=0.2), axis.line.y=element_blank(),panel.grid.major=element_line(color="gray50", size=0.5), panel.grid.major.x = element_blank())
  })
  
  #text used to display a key for the data
  output$text <- renderText({"Personal WellBeing (PWB) Scores Key:"})
  output$text2 <- renderText({"Low Anxiety=High PWB"})
  output$text3 <- renderText({"Low Happiness,Low Satisfaction, Low Worthwhile = Low PWB"})
  
  output$down <- downloadHandler( #code to enable download of specific plot
    filename = function(){
     paste("pwb",input$year,input$filetype,sep='.') #code to name file being downloaded 
    },
    content = function(file){
      if(input$filetype == "png")
        png(file)
      else
        pdf(file) 
      plot(ggplot(pwbestlocalauth, aes(x= pwb, y=get(input$year), color = Geography)) + geom_point(size=3, position=position_jitter(h=.15,w=.12)) +  geom_smooth(alpha=0.3, method = 'lm') + labs(x = "Personal Wellbeing Measures", y = "Scores", title = "Personal Wellbeing Scores") + scale_colour_manual(values=cbPalette) + theme_light() + theme(text=element_text(color="black", size=11), legend.position = c("top"), legend.direction = "horizontal", axis.title.x=element_text(vjust=-1.5),
                              legend.justification = 0.5, legend.text=element_text(size=11,color="black"), axis.line=element_line(color="black", size=0.2), axis.line.y=element_blank(),panel.grid.major=element_line(color="gray50", size=0.5), panel.grid.major.x = element_blank()))
  dev.off()
    }
  )
  
  

})

shinyApp(ui, server)
```

### Interpretation of Visualisation:

Based on the Shiny graphs, it is evident that overall, Northern Ireland has higher PWB scores across all measures, in comparison to other UK countries. In comparison, Wales seems to have the worst PWB scores across all measures.

# Summary

What I have learnt:

-   how to create a shiny interface to display different graphs based on a variable (year) within the dataset
-   different ways of customising a scatterplot to appear more visually pleasing

If I had more time to spend on this project:

-   I would have found a way to use the click() feature, so that when a point on the plot was clicked on, the country and its equivalent personal-well being score for the specific measure would be displayed.

# Resources used

When completing this project the main resoruces I found helpful were stackoverflow.com and rStudio.com. In particular the cheatsheets provided on rStudio were extremely helpful for more simple code.
